<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>

    Customary Cookbook tests

</title></head><body>

<h1>Customary Cookbook üë©‚Äçüî¨üî¨ tests</h1>

<template data-customary-name="test-runner">
<button autofocus>Run tests</button>
</template>

<test-runner></test-runner>

<div id="mocha"></div>

<script type="importmap">
    {
        "imports": {
            "chai": "./../node_modules/chai/chai.js",
            "mocha": "./../node_modules/mocha/mocha.js",
            "mocha.css": "./../node_modules/mocha/mocha.css",
            "#customary-cookbook/": "./",
            "#customary-testing": "./../node_modules/customary/web/_script/now.js",
            "#customary": "./../node_modules/customary/web/_script/now.js",
            "#customary/": "./../node_modules/customary/web/_script/",
            "#customary/lit": "./../node_modules/customary/.dist/bundled/customary-library.mjs"
        }
    }
</script>
<script type="module">
    // https://medium.com/dailyjs/running-mocha-tests-as-native-es6-modules-in-a-browser-882373f2ecb0
    import 'mocha';
    mocha.setup({ui: 'bdd', checkLeaks: true});
    mocha.cleanReferencesAfterRun(false);
</script>
<script type="module">
    import {CustomaryCookbookData} from '#customary-cookbook/data/CustomaryCookbookData.js';

    async function import_tests() {
        const data = await CustomaryCookbookData.loadData();
        for (const test of data.tests) {
            await import(`./${test}`);
        }
    }

    //
    async function connected() {
        await import_tests();
        const params = new URLSearchParams(window.location.search);
        if (params.has("run")) {
            run_unit_tests();
        }
    }
    function run_unit_tests() {
        document.getElementById('mocha').replaceChildren();
        mocha.run();
    }
    const cssLocation = import.meta.resolve('mocha.css');
    /**
     * @type {CustomaryDeclaration}
     */
    globalThis['customary:test-runner'] = {
        config: {
            define: {fontLocation: cssLocation}
        },
        hooks: {
            lifecycle: {connected: connected},
            events: {'button': run_unit_tests}
        }
    };
    //
</script>
<script type="module">import '#customary';</script>

</body>

</html>
