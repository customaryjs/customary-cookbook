<html lang="en" xmlns:customary="https://customaryjs.github.io/schema">
<title>Events ~ updates ~ Customary Cookbook</title>

<h1>Customary Events</h1>

<p>~ with updates ~</p><br/>

<template data-customary-name="events-updates-recipe">
    <customary:for items="{{dynamic_faces}}" value="item" index="index">
        <button value="{[index]}" class="dynamic">{[item]}</button>
    </customary:for>
    <customary:if condition="{{add_button_visible}}">
        <button id="add_button">Add another button</button>
    </customary:if>
</template>

<events-updates-recipe></events-updates-recipe>

<script type="importmap">{"imports": {
    "#customary": "../../../node_modules/customary/src/now.js",
    "#customary/": "../../../node_modules/customary/src/",
    "#customary/lit": "../../../node_modules/customary/.dist/bundled/customary-library.mjs"
}}</script>
<script type="module">
    /**
     * @type {CustomaryDeclaration}
     */
    globalThis['customary:events-updates-recipe'] = {
        config: {
            state: ['dynamic_faces', 'number_of_buttons'],
        },
        values: {
            'dynamic_faces': [],
            'number_of_buttons': 3,
            'names_of_buttons': ["One", "Two", "Three", "Four", "Five", "Six", "Seven"]
        },
        hooks: {
            lifecycle: {
                willUpdate: el =>
                    el.add_button_visible = el.number_of_buttons < el.names_of_buttons.length,
            },
            changes: {
                'number_of_buttons': (el, a, z) => {
                    el.dynamic_faces =
                        [
                            ...el.dynamic_faces,
                            ...el.names_of_buttons.slice(
                                el.dynamic_faces.length, el.number_of_buttons
                            )
                        ];
                }
            },
            events: {
                '#add_button': el =>
                    el.number_of_buttons = el.number_of_buttons + 1,
                'button.dynamic': (el, event, target) => {
                    const index = Number.parseInt(target.value);
                    const list = [...el.dynamic_faces];
                    list[index] = list[index].split('').reverse().join('');
                    el.dynamic_faces = list;
                },
            },
        }
    }
</script>
<script type="module">import '#customary';</script>
</html>