<!doctype html>

<html>
<head>
    <title>Customary: test ALL the things!</title>
</head>
<body>
<h1>Customary: test ALL the things!</h1>
<button autofocus onclick="run_unit_tests()">Run unit tests</button>
<div id="mocha"></div>
</body>

<script type="importmap">
    {
        "imports": {
            "customary-tutorials/": "../",
            "customary/": "../../node_modules/customary/web/_script/",
            "chai": "../../node_modules/chai/chai.js",
            "mocha": "../../node_modules/mocha/mocha.js",
            "mocha.css": "../../node_modules/mocha/mocha.css"
        }
    }
</script>

<script type="module">
    // https://medium.com/dailyjs/running-mocha-tests-as-native-es6-modules-in-a-browser-882373f2ecb0
    import 'mocha';
    mocha.setup({'ui': 'bdd'});
    mocha.cleanReferencesAfterRun(false);
</script>
<script type="module">
    import {CSSStyleSheetAdopter} from 'customary/cssstylesheet/CSSStyleSheetAdopter.js';
    import {CSSStyleSheetImporter} from 'customary/cssstylesheet/CSSStyleSheetImporter.js';
    await new CSSStyleSheetAdopter(new CSSStyleSheetImporter(), document)
        .adoptCSSStylesheets(import.meta.resolve('mocha.css'));
</script>
<script type="module">
    import {CustomaryTutorialsData} from 'customary-tutorials/data/CustomaryTutorialsData.js';
    const data = await CustomaryTutorialsData.loadData();
    for (const test of data.tests) {
        await import(`../${test}`);
    }
</script>
<script type="application/javascript">
    function run_unit_tests() {
        document.getElementById('mocha').replaceChildren();
        mocha.run();
    }
</script>
</html>
